class SBurn():
    @staticmethod
    def get_instance(xsize, ysize, fps=30):
        return SBurn(xsize, ysize, fps)
    
    def get_frame(self):
        if not next(self.wait):
            self.set_frame(self.bitmaps[next(self.get_index)])
        return self.frame

    # Iterate from first to last, then from last to first
    def iter_direction(self):
        row = [0,0,0,1,2,3,4,5,4,3,2,1,0,1,2,3,4,5,4,3,2,6,7,8,8,8,8]
        while True:
            for x in row:
                yield x

    def wait_time(self):
        state = 150
        while True:
            if state >= 50:
                state = 0
                yield False
            else:
                state += 1
                yield True
    
    def set_frame(self, bitmap):
        for x in range(28):
            for y in range(14):
                if bitmap[y][x] == "1":
                    self.frame[x][y] = self.color_main
                elif bitmap[y][x] == "2":
                    self.frame[x][y] = self.color_fire_outer
                elif bitmap[y][x] == "3":
                    self.frame[x][y] = self.color_fire_inner
                elif bitmap[y][x] == "4":
                    self.frame[x][y] = self.color_fire_main
                else:
                    self.frame[x][y] = (0,0,0)


    def __init__(self,xsize=28, ysize=14, fps=30):
        self.name = "IBD - Stomach burning"
        self.xsize = xsize
        self.ysize = ysize
        
        self.color_main = (102,38,130)
        self.color_fire_outer = (255,50,50)
        self.color_fire_inner = (255,140,45)
        self.color_fire_main = (255,230,10)
        
        self.get_index = self.iter_direction()
        self.wait = self.wait_time()

        self.frame = []
        for x in range(xsize):
            self.frame.append([])
            for y in range(ysize):
                self.frame[x].append([0,0,0])

        self.state = 0
        self.bitmaps = [["0000000000000000000000000000",
                         "0000000000001111000000000000",
                         "0000000000011111100000000000",
                         "0000000000011111100000000000",
                         "0000000000001111000000000000",
                         "0000001111111111111111000000",
                         "0000001111111111111111000000",
                         "0000000001111111111000000000",
                         "0000000001111111111000000000",
                         "0000000001111111111000000000",
                         "0000000000111111110000000000",
                         "0000000000111001110000000000",
                         "0000000000111001110000000000",
                         "0000000000000000000000000000"],
                        
                        ["0000000000011111100000000000",
                         "0000000000111111110000000000",
                         "0000000000111111110000000000",
                         "0000000000011111100000000000",
                         "0001111111111111111111111000",
                         "0001111111111111111111111000",
                         "0000000111111111111110000000",
                         "0000000111111111111110000000",
                         "0000000111111111111110000000",
                         "0000000111111111111110000000",
                         "0000000011111111111100000000",
                         "0000000001110000111000000000",
                         "0000000001110000111000000000",
                         "0000000001110000111000000000"],
                        
                        ["0000000001111111111000000000",
                         "0000000000011111100000000000",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "0000011111111111111111100000",
                         "0000011111111111111111100000",
                         "0000011111111111111111100000",
                         "0000011111111111111111100000",
                         "0000011111111111111111100000",
                         "0000011111111111111111100000",
                         "0000001111111111111111000000",
                         "0000000011111111111100000000",
                         "0000000001110000111000000000",
                         "0000000001110000111000000000"],
                        
                        ["0000000001111111111000000000",
                         "0000000000011111100000000000",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "0000011111111111111111100000",
                         "0000011111111111111111100000",
                         "0000011111111111111111100000",
                         "0000011111111121111111100000",
                         "0000011111111231111111100000",
                         "0000011111111111111111100000",
                         "0000001111111111111111000000",
                         "0000000011111111111100000000",
                         "0000000001110000111000000000",
                         "0000000001110000111000000000"],
                        
                        ["0000000001111111111000000000",
                         "0000000000011111100000000000",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "0000011111111111111111100000",
                         "0000011111111111111111100000",
                         "0000011111111121111111100000",
                         "0000011111112232111111100000",
                         "0000011111123343211111100000",
                         "0000011111112444211111100000",
                         "0000001111111111111111000000",
                         "0000000011111111111100000000",
                         "0000000001110000111000000000",
                         "0000000001110000111000000000"],
                        
                        ["0000000001111111111000000000",
                         "0000000000011111100000000000",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "0000011111111111111111100000",
                         "0000011111111211111111100000",
                         "0000011111112321111111100000",
                         "0000011111112432111111100000",
                         "0000011111123443211111100000",
                         "0000011111112444211111100000",
                         "0000001111111111111111000000",
                         "0000000011111111111100000000",
                         "0000000001110000111000000000",
                         "0000000001110000111000000000"],

                        ["0000000000111111110000000000",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "0000111111111111111111110000",
                         "0000111111111111111111110000",
                         "0000111111111111111111110000",
                         "0000111111111111111111110000",
                         "0000111111111111111111110000",
                         "0000111111111111111111110000",
                         "0000111111111111111111110000",
                         "0000111111111111111111110000",
                         "0000011111111111111111100000",
                         "0000001111111111111111000000",
                         "0000000011110000111100000000"],
                         
                        ["1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "0011111111111111111111111100",
                         "0011111111111111111111111100",
                         "0011111111111111111111111100",
                         "0011111111111111111111111100",
                         "0011111111111111111111111100",
                         "0011111111111111111111111100",
                         "0011111111111111111111111100",
                         "0011111111111111111111111100",
                         "0011111111111111111111111100",
                         "0001111111111111111111111000",
                         "0000111111111111111111110000"],
                         
                        ["1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111",
                         "1111111111111111111111111111"]]